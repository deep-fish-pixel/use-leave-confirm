{"version":3,"file":"bundle.cjs.js","sources":["../src/confirm.ts","../src/index.ts"],"sourcesContent":["export default function (options: {\n  confirm?: () => void,\n  cancel?: () => void,\n\tcontentText: string,\n\tconfirmText: string,\n\tcancelText: string,\n}) {\n  const confirmEl = document.createElement('div');\n\n  confirmEl.setAttribute('class', 'lc-dialog');\n  confirmEl.setAttribute('style', 'z-index: 9999;');\n  confirmEl.innerHTML = `\n    <div class=\"lc-dialog__mask\"></div>\n    <div class=\"lc-dialog__container\">\n      <div class=\"lc-dialog__inner\">\n        <div class=\"lc-dialog__icon-box\">\n          <i class=\"lc-icon lc-icon_warning\"></i>\n        </div>\n        <div class=\"lc-dialog__main\">\n          <div class=\"lc-dialog__body\">${options.contentText}</div>\n          <div class=\"lc-dialog__footer\">\n            <div class=\"lc-dialog__default-footer\">\n              <button class=\"lc-button lc-button--normal lc-button--plain\" type=\"button\">\n                <div class=\"lc-button__content\">${options.cancelText}</div>\n              </button>\n              <button class=\"lc-button lc-button--primary\" type=\"button\">\n                <div class=\"lc-button__content\">${options.confirmText}</div>\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n   `;\n\n  document.body.append(confirmEl);\n\n  const normalButton = confirmEl.querySelector('.lc-button--normal');\n  const primaryButton = confirmEl.querySelector('.lc-button--primary');\n\n  function close() {\n    document.body.removeChild(confirmEl);\n    if(normalButton) {\n      normalButton.removeEventListener('click', cancelHandle)\n    }\n    if(primaryButton) {\n      primaryButton.removeEventListener('click', confirmHandle)\n    }\n  }\n  const cancelHandle = () => {\n    if(options.cancel) {\n      options.cancel();\n    }\n    close();\n  }\n  const confirmHandle = () => {\n    if(options.confirm) {\n      options.confirm();\n    }\n    close();\n  }\n\n  return {\n    show(){\n      confirmEl.style.display = 'block';\n      if(normalButton) {\n        normalButton.addEventListener('click', cancelHandle)\n      }\n      if(primaryButton) {\n        primaryButton.addEventListener('click', confirmHandle)\n      }\n\n      setTimeout(() => {\n        confirmEl.setAttribute('class', confirmEl.getAttribute('class') + ' lc-dialog-show');\n      }, 10);\n    },\n    close(){\n      close();\n    },\n    cancel(){\n      close();\n    },\n    confirm(){\n      confirmHandle();\n    }\n  };\n}\n","import { extendListeners, } from 'extend-window-listener';\nimport confirm from './confirm';\n\nconst objectClass = Object;\n\ninterface PopState {\n  // vue\n  position: number;\n  // react\n  idx: number;\n  replaced?: boolean;\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nconst config = objectClass.__leave_confirm__ || {\n  option: {\n  },\n  href: '',\n  state: ({\n    // vue\n    position: -1,\n    // react\n    idx: -1,\n    replaced: false,\n  }) as PopState,\n  data: {} as any,\n  snapshot: '{}',\n  navigator: {\n    doing: false,\n    navigate: (name: string) => {},\n  },\n  contentText: '离开后，已编辑的内容将被清除',\n  confirmText: '确认离开',\n  cancelText: '取消',\n  lastResolver: {\n    time: -1,\n    value: false,\n    isValid(timer = 30) {\n      return Date.now() - this.time < timer;\n    },\n    update(value: boolean) {\n      this.value = value;\n      this.time = Date.now();\n    },\n  },\n  isReact: false,\n};\n\n// 解决fms通讯问题\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nobjectClass.__leave_confirm__ = config;\n\nfunction handleBeforeUnload(event: BeforeUnloadEvent) {\n  if (hasEdited()) {\n    event.preventDefault();\n    event.returnValue = config.contentText;\n  }\n}\n\nfunction addBeforeUnload() {\n  window.addEventListener('beforeunload', handleBeforeUnload);\n}\n\nfunction removeBeforeUnload() {\n  window.removeEventListener('beforeunload', handleBeforeUnload);\n}\n\nextendListeners('popstate');\n\n\nfunction addRouter() {\n  extendListeners('hashchange');\n  window.addEventListener('popstate', (event: PopStateEvent) => {\n    const state = event.state || {};\n\n    if(event.singleSpaTrigger && config.lastResolver.isValid(500)){\n      return Promise.resolve(false);\n    }\n\n    return resolveConfirm(state);\n  });\n  // @ts-ignore\n  window.addEventListener('hashchange', (event: PopStateEvent) => new Promise(() => {}));\n}\n\nfunction resetInnerState() {\n  Object.assign(config, {\n    href: '',\n    state: {\n      // vue\n      position: -1,\n      // react\n      idx: -1,\n      ...history.state,\n    },\n    data: {} as any,\n    snapshot: '{}',\n  });\n}\n\nfunction getData() {\n  if (typeof config.data === 'function') {\n    return config.data();\n  }\n  return config.data;\n\n}\n\nfunction setData(value?: any) {\n  if (arguments.length) {\n    config.href = window.location.href;\n    config.data = value;\n  }\n\n  config.snapshot = JSON.stringify(getData());\n}\n\nfunction hasEdited() {\n  return config.snapshot !== JSON.stringify(getData());\n}\n\nfunction hrefDiff() {\n  return config.href !== window.location.href;\n}\n\nfunction statePositionSub(state: PopState) {\n  if (state.position >= 0 && config.state.position >= 0 && state.position !== config.state.position) {\n    return config.state.position - state.position;\n  }\n  if (state.idx >= 0 && config.state.idx >= 0 && state.idx !== config.state.idx) {\n    return config.state.idx - state.idx;\n  }\n}\n\nfunction resolveConfirm(state: PopState, command = false) {\n  if (config.navigator.doing) {\n    return Promise.resolve(false);\n  }\n\n  return new Promise((resolve, reject) => {\n    const valid = config.lastResolver.isValid();\n\n    if (valid) {\n      resolve(config.lastResolver.value);\n    } else if (config.href && hasEdited() && (statePositionSub(state) || command)) {\n      confirm({\n        confirm() {\n          resetInnerState();\n          resolve(false);\n          config.lastResolver.update(false);\n        },\n        cancel() {\n          if (state.position >= 0 && config.state.position >= 0 && state.position != config.state.position && hrefDiff()) {\n            window.history.go(config.state.position - state.position);\n            resolve(true);\n            config.lastResolver.update(true);\n          } else if (state.idx >= 0 && config.state.idx >= 0 && state.idx != config.state.idx && hrefDiff()) {\n            window.history.go(config.state.idx - state.idx);\n            resolve(true);\n            config.lastResolver.update(true);\n          } else if (command) {\n            resolve(true);\n            config.lastResolver.update(true);\n          } else {\n            resolve(true);\n            config.lastResolver.update(true);\n            // reject(new Error('没有检测到前进后退的位置'));\n          }\n        },\n        contentText: config.contentText,\n        confirmText: config.confirmText,\n        cancelText: config.cancelText,\n      }).show();\n    } else {\n      // 返回不能清空\n      resetInnerState();\n      resolve(false);\n      config.lastResolver.update(false);\n    }\n  });\n}\n\nexport function extendVueRouter(router: any) {\n  router.push = extendRouterMethod('push');\n  router.replace = extendRouterMethod('replace');\n  router.go = extendRouterMethod('go');\n  router.back = extendRouterMethod('back');\n  router.forward = extendRouterMethod('forward');\n\n  function extendRouterMethod(name: string) {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    const method = router[name];\n\n    return (...params: any[]) => resolveConfirm({\n      position: config.state.position,\n      idx: 0,\n    }, true).then((result) => {\n      if (!result) {\n        if(name === 'push' || name === 'replace'){\n          config.lastResolver.update(false);\n        }\n        return method.apply(router, params as any);\n      }\n    });\n  }\n}\n\nexport const install = {\n  install: (app: any) => {\n    if(!app.config.globalProperties.$router){\n      console.error('use-leave-confirm should install after vue-router! Otherwise, it may cause partial failure.');\n      return;\n    }\n    extendVueRouter(app.config.globalProperties.$router);\n  }\n};\n\nexport function extendReactHistory() {\n  config.isReact = true;\n  // @ts-ignore\n  window.history.pushState = extendHistoryMethod('pushState');\n  // @ts-ignore\n  window.history.replaceState = extendHistoryMethod('replaceState');\n\n\n  function extendHistoryMethod(name: string) {\n    // @ts-ignore\n    const method = window.history[name];\n\n    return (...params: any[]) => {\n      params[1] = params[1].replace(/^#.+#/, '#');\n\n      if (config.navigator.doing || !config.href) {\n        return method.apply(window.history, params as any);\n      }\n\n      return resolveConfirm(params[0], true).then((result) => {\n        if (!result) {\n          if (window.location.href !== params[1]) {\n            resetInnerState();\n          } else {\n            resetInnerState();\n          }\n\n          config.navigator.doing = true;\n          try {\n            config.navigator.navigate(params[1]);\n          } finally {\n            config.navigator.doing = false;\n          }\n        }\n      });\n    };\n  }\n}\n\n/**\n * 数据改变离开确认\n * @param value 数据源\n * @param option\n * @example useLeaveConfirm(data) or useLeaveConfirm(() => data);\n */\nexport function useLeaveConfirm(value?: any, option: {\n  navigate?: any,\n  contentText?: string,\n  confirmText?: string\n  cancelText?: string\n} = {}) {\n  if (value && (!config.isReact || config.isReact && config.href !== window.location.href)) {\n    Object.assign(\n      config.state,\n      history.state\n    );\n    setData(value);\n  }\n\n  Object.assign(config, option);\n\n  if (option.navigate) {\n    config.navigator.navigate = option.navigate;\n    delete option.navigate;\n  }\n\n  return {\n    snapshot(value?: any) {\n      if (arguments.length) {\n        setData(value);\n      } else {\n        setData();\n      }\n    },\n  };\n}\n\naddRouter();\naddBeforeUnload();\n"],"names":["extendListeners"],"mappings":"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"}