{"version":3,"file":"bundle.cjs.js","sources":["../src/serializeCall.ts","../src/extendWindowListener.ts","../src/confirm.ts","../src/index.ts"],"sourcesContent":["/**\n * 序列化调用 返回true 或 resolve(true) 调用链终止\n * @param handles\n */\nexport default function (handles: Array<Function>) {\n  let index = -1;\n\n  function next(...args: any[]): any {\n    index++;\n\n    if(handles[index]){\n      const result = handles[index].call(window, ...args);\n\n      if(!result){\n        return next(...args);\n      }\n\n      if(result && result.then){\n        return result.then((res: boolean) => {\n          if(!res){\n            return next(...args);\n          }\n          return true;\n        });\n      }\n    }\n\n    return false;\n  }\n\n  return next;\n}\n","import serializeCall from \"./serializeCall\";\n\ntype Listener = (evt: Event) => void;\n\nconst listeners: Record<string, {\n  rootHandle: Listener;\n  handles: Array<Listener>,\n}> = {};\nconst addEventListenerOriginal = window.addEventListener;\nconst removeEventListenerOriginal = window.removeEventListener;\n\nwindow.addEventListener = function extendAddEventListener(...params: any[]) {\n  const eventName = params[0];\n  const handle = params[1];\n\n  if (!handle) {\n    return;\n  }\n\n  const listener = listeners[eventName];\n\n  if (listener) {\n    // 添加句柄\n    listener.handles.push(handle);\n  } else {\n    // @ts-ignore\n    addEventListenerOriginal.apply(window, params);\n  }\n};\n\nwindow.removeEventListener = function extendRemoveEventListener(...params: any[]) {\n  const eventName = params[0];\n  const handle = params[1];\n\n  if (!handle) {\n    return;\n  }\n\n  const listener = listeners[eventName];\n\n  if (listener) {\n    listener.handles.some((fn, index) => {\n      if(fn === handle){\n        // 剔除指定句柄\n        listener.handles.splice(index, 1);\n        return true;\n      }\n    });\n  } else {\n    // @ts-ignore\n    removeEventListenerOriginal.apply(window, params);\n  }\n};\n\n/**\n * 扩展window事件\n * @param extendEventNames 扩展事件名称\n * @example extendListeners('popstate', 'hashchange');\n */\nexport function extendListeners(...extendEventNames: string[]) {\n  extendEventNames.forEach((eventName) => {\n    // @ts-ignore\n    addEventListenerOriginal.call(window, eventName, extendHandle);\n    listeners[eventName] = {\n      rootHandle: extendHandle,\n      handles: [],\n    };\n\n    function extendHandle(event: Event) {\n      const listener = listeners[eventName];\n\n      const next = serializeCall(listener.handles);\n\n      next(event);\n    }\n  });\n}\n\n/**\n * 移除扩展window事件\n * @param extendEventNames 需要移除的扩展事件名称\n * @example removeExtendListeners('popstate', 'hashchange');\n */\nexport function removeExtendListeners(...extendEventNames: string[]) {\n  extendEventNames.forEach((eventName) => {\n    const listener = listeners[eventName];\n\n    if(listener){\n      removeEventListenerOriginal.call(window, eventName, listener.rootHandle);\n      delete listeners[eventName];\n    }\n  });\n}\n","const style = document.createElement('style');\n\nstyle.setAttribute('type', 'text/css');\nstyle.innerHTML = `\n.lc-dialog {\n  position: relative;\n  z-index: 9999;\n  display: none;\n}\n.lc-dialog__mask {\n  position: fixed;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  background: rgba( 0, 0, 0 , .7 );\n  opacity: 0;\n  transition: opacity 0.3s;\n}\n.lc-dialog-show .lc-dialog__mask{\n  opacity: 1;\n}\n.lc-dialog__container {\n  position: fixed;\n  right: 0;\n  left: 0;\n  display: flex;\n  max-width: 92%;\n  max-height: 84%;\n  margin: 0 auto;\n  padding: 24px;\n  background: rgb( 255, 255, 255 );\n  border-radius: 4px;\n  box-shadow: 0 3px 6px -4px rgba( 0, 0, 0 , 10%), 0 6px 16px 0 rgba( 0, 0, 0 , 6%), 0 9px 28px 8px rgba( 0, 0, 0 , 3%);\n  width: 420px;\n  max-height: 50%;\n  top: 50%;\n  opacity: 0.5;\n  transform: translateY(-50%) scale(0.5);\n  transition: all 0.3s;\n  overflow: hidden;\n}\n.lc-dialog-show .lc-dialog__container{\n  transform: translateY(-50%) scale(1);\n  opacity: 1;\n}\n.lc-dialog__inner {\n  display: flex;\n  flex: 1;\n  min-width: 0;\n  min-height: 0;\n}\n.lc-dialog__icon-box {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 22px;\n  margin-right: 12px;\n}\n.lc-dialog__main {\n  display: flex;\n  flex: 1;\n  flex-direction: column;\n  min-width: 0;\n  min-height: 0;\n}\n.lc-dialog__body {\n  flex: 1;\n  margin-inline: calc(0px - 24px);\n  padding-inline: 24px;\n  overflow: auto;\n}\n.lc-dialog__footer {\n  flex: none;\n  margin-top: 24px;\n}\n.lc-dialog__default-footer {\n  text-align: right;\n}\n.lc-dialog__default-footer .lc-button{\n  margin-left: 16px;\n}\n.lc-dialog__default-footer .lc-button:first-child{\n  margin-left: 0;\n}\n.lc-button {\n  display: inline-flex;\n  grid-column-gap: 4px;\n  align-items: center;\n  justify-content: center;\n  height: 32px;\n  padding: 0 16px;\n  font-size: 14px;\n  line-height: 1.5;\n  white-space: nowrap;\n  vertical-align: middle;\n  border: 1px solid rgba(0,0,0,0);\n  border-radius: 4px;\n  cursor: pointer;\n  transition: all .3s;\n  color: #fff;\n  background: #02b3be;\n  border-color: rgba(0,0,0,0);\n  outline: none;\n}\n.lc-button.lc-button--primary {\n  border-color: #02b3be;\n  outline: none;\n}\n.lc-button.lc-button--primary:active {\n  background: #087d85;\n  border-color: #087d85;\n}\n.lc-button--plain.lc-button--normal:not(.is-ghost) {\n  color: rgb( 4, 11, 41 );\n  background: #fff;\n  border-color: rgb( 206, 208, 216 );\n  outline: none;\n}\n.lc-button--plain.lc-button--normal:not(.is-ghost):active {\n  background: #ddd;\n}\n`;\n\nexport default function (options: {\n  confirm?: () => void,\n  cancel?: () => void,\n\tcontentText: string,\n\tconfirmText: string,\n\tcancelText: string,\n}) {\n  const confirmEl = document.createElement('div');\n\n  confirmEl.setAttribute('class', 'lc-dialog');\n  confirmEl.setAttribute('style', 'z-index: 9999;');\n  confirmEl.innerHTML = `\n    <div class=\"lc-dialog__mask\"></div>\n    <div class=\"lc-dialog__container\">\n      <div class=\"lc-dialog__inner\">\n        <div class=\"lc-dialog__icon-box\">\n          <i class=\"lc-icon lc-icon_warning_filled lc-dialog__icon\"\n                                           style=\"font-size: 22px; color: rgb(253, 167, 28);\"></i>\n        </div>\n        <div class=\"lc-dialog__main\">\n          <div class=\"lc-dialog__body\">${options.contentText}</div>\n          <div class=\"lc-dialog__footer\">\n            <div class=\"lc-dialog__default-footer\">\n              <button class=\"lc-button lc-button--normal lc-button--plain\" type=\"button\">\n                <div class=\"lc-button__content\">${options.cancelText}</div>\n              </button>\n              <button class=\"lc-button lc-button--primary\" type=\"button\">\n                <div class=\"lc-button__content\">${options.confirmText}</div>\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n   `;\n\n  document.body.append(confirmEl);\n\n  if(!style.parentElement){\n    document.head.append(style);\n  }\n\n  const normalButton = confirmEl.querySelector('.lc-button--normal');\n  const primaryButton = confirmEl.querySelector('.lc-button--primary');\n\n  function close() {\n    document.body.removeChild(confirmEl);\n    if(normalButton) {\n      normalButton.removeEventListener('click', cancelHandle)\n    }\n    if(primaryButton) {\n      primaryButton.removeEventListener('click', confirmHandle)\n    }\n  }\n  const cancelHandle = () => {\n    if(options.cancel) {\n      options.cancel();\n    }\n    close();\n  }\n  const confirmHandle = () => {\n    if(options.confirm) {\n      options.confirm();\n    }\n    close();\n  }\n\n  return {\n    show(){\n      confirmEl.style.display = 'block';\n      if(normalButton) {\n        normalButton.addEventListener('click', cancelHandle)\n      }\n      if(primaryButton) {\n        primaryButton.addEventListener('click', confirmHandle)\n      }\n\n      setTimeout(() => {\n        confirmEl.setAttribute('class', confirmEl.getAttribute('class') + ' lc-dialog-show');\n      }, 10);\n    },\n    close(){\n      close();\n    },\n    cancel(){\n      close();\n    },\n    confirm(){\n      confirmHandle();\n    }\n  };\n}\n","import { extendListeners, } from \"./extendWindowListener\";\nimport confirm from './confirm';\n\ninterface PopState {\n\t// vue\n\tposition: number;\n\t// react\n\tidx: number;\n\treplaced?: boolean;\n}\n\nconst config = {\n\toption: {\n\t},\n\thref: '',\n\tstate: Object.assign(\n\t\t{\n\t\t\t// vue\n\t\t\tposition: -1,\n\t\t\t// react\n\t\t\tidx: -1,\n\t\t\treplaced: false,\n\t\t},\n\t) as PopState,\n\tdata: {} as any,\n\tsnapshot: '{}',\n\tnavigator: {\n\t\tdoing: false,\n\t\tnavigate: (name: string) => {},\n\t},\n\tcontentText: '离开后，已编辑的内容将被清除',\n\tconfirmText: '确认离开',\n\tcancelText: '取消',\n};\n\nconst lastResolver = {\n\ttime: -1,\n\tvalue: false,\n\tisValid(){\n\t\treturn Date.now() - this.time < 30;\n\t},\n\tupdate(value: boolean){\n\t\tthis.value = value;\n\t\tthis.time = Date.now();\n\t}\n};\n\nfunction handleBeforeUnload(event: BeforeUnloadEvent) {\n  if (hasEdited()) {\n    event.preventDefault();\n    event.returnValue = config.contentText;\n  }\n}\n\nfunction addBeforeUnload() {\n  window.addEventListener(\"beforeunload\", handleBeforeUnload);\n}\n\nfunction removeBeforeUnload() {\n  window.removeEventListener(\"beforeunload\", handleBeforeUnload);\n}\n\nextendListeners(\"popstate\");\n\nfunction addRouter() {\n  window.addEventListener(\"popstate\", function (event: PopStateEvent) {\n    console.log(event.state);\n    const state = event.state || {};\n\n    return resolveConfirm(state);\n  });\n}\n\nfunction extendReactHistoryApi() {\n  function extendHistoryMethod(name: string) {\n    // @ts-ignore\n    const method = window.history[name];\n\n    return (...params: any[]) => {\n\t\t\tparams[2] = params[2].replace(/^#.+#/, '#');\n\n\t\t\tif(config.navigator.doing || !config.href){\n\t\t\t\treturn method.apply(window.history, params as any);\n\t\t\t}\n\n\t\t\treturn resolveConfirm(params[0], true).then((result) => {\n        if(!result){\n          if(window.location.href !== params[2]) {\n            resetInnerState();\n          } else {\n            resetInnerState();\n          }\n\n\t\t\t\t\tconfig.navigator.doing = true;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconfig.navigator.navigate(params[2]);\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tconfig.navigator.doing = false;\n\t\t\t\t\t}\n        }\n      });\n    };\n  }\n\n  // @ts-ignore\n  window.history.pushState = extendHistoryMethod(\"pushState\");\n  // @ts-ignore\n  window.history.replaceState = extendHistoryMethod(\"replaceState\");\n}\n\nfunction resetInnerState() {\n  Object.assign(config, {\n    href: '',\n    state: Object.assign(\n      {\n        // vue\n        position: -1,\n        // react\n        idx: -1\n      },\n      history.state\n    ),\n    data: {} as any,\n    snapshot: '{}',\n  });\n}\n\nfunction getData() {\n\tif(typeof config.data === 'function'){\n\t\treturn config.data();\n\t} else {\n\t\treturn config.data;\n\t}\n}\n\nfunction setData(value?: any) {\n  if(arguments.length){\n    config.href = window.location.href;\n\t\tconfig.data = value\n  }\n\n  config.snapshot = JSON.stringify(getData());\n}\n\nfunction hasEdited() {\n  return config.snapshot !== JSON.stringify(getData());\n}\n\nfunction hrefDiff() {\n\treturn config.href !== window.location.href;\n}\n\nfunction statePositionSub(state: PopState) {\n  if (state.position >= 0 && config.state.position >= 0 && state.position !== config.state.position){\n    return config.state.position - state.position;\n  }\n  if(state.idx >= 0 && config.state.idx >= 0 && state.idx !== config.state.idx){\n    return config.state.idx - state.idx;\n  }\n}\n\nfunction resolveConfirm(state: PopState, command: boolean = false) {\n\tif(config.navigator.doing){\n\t\treturn Promise.resolve(false);\n\t}\n\n  return new Promise((resolve, reject) => {\n    if(lastResolver.isValid()){\n      resolve(lastResolver.value);\n    }\n    else if(config.href && hasEdited() && (statePositionSub(state) || command)){\n      confirm({\n        confirm(){\n          resetInnerState();\n          resolve(false);\n          lastResolver.update(false);\n        },\n        cancel(){\n          /*if(state.replaced){\n              // reject(new Error('禁止离开'));\n              // // resolve(true);\n              // throw new Error('禁止离开');\n              resolve(true);\n            }\n            // 前进 后退\n            else*/ if (state.position >= 0 && config.state.position >= 0 && state.position != config.state.position && hrefDiff()) {\n            window.history.go(config.state.position - state.position);\n            resolve(true);\n            lastResolver.update(true);\n          } else if (state.idx >= 0 && config.state.idx >= 0 && state.idx != config.state.idx && hrefDiff()) {\n            window.history.go(config.state.idx - state.idx);\n            resolve(true);\n            lastResolver.update(true);\n          } else if(command){\n            resolve(true);\n            lastResolver.update(true);\n          } else {\n            reject(new Error('没有检测到前进后退的位置'));\n            // lastResolver.update(false);\n          }\n        },\n\t\t\t\tcontentText: config.contentText,\n\t\t\t\tconfirmText: config.confirmText,\n\t\t\t\tcancelText: config.cancelText,\n      }).show();\n    } else {\n      // 返回不能清空\n      // resetInnerState();\n      resolve(false);\n      lastResolver.update(false);\n    }\n  });\n}\n\n\nexport function extendVueRouterApi(router: any) {\n  console.log(router);\n  router.push = extendRouterMethod(\"push\");\n  router.replace = extendRouterMethod(\"replace\");\n  router.go = extendRouterMethod(\"go\");\n\n  function extendRouterMethod(name: string) {\n    // @ts-ignore\n    const method = router[name];\n\n    return (...params: any[]) => {\n      return resolveConfirm({\n        position: config.state.position,\n        idx: 0,\n      }, true).then((result) => {\n        if(!result){\n          return method.apply(router, params as any);\n        }\n      });\n\n    };\n  }\n\n}\n\n/**\n * 数据改变离开确认\n * @param value 数据源\n * @param option\n * @example useLeaveConfirm(data) or useLeaveConfirm(() => data);\n */\nexport function useLeaveConfirm(value?: any, option: {\n\tnavigate?: any,\n\tcontentText?: string,\n\tconfirmText?: string\n\tcancelText?: string\n} = {}) {\n  if(arguments.length && config.href !== window.location.href){\n    Object.assign(\n      config.state,\n      history.state\n    );\n    setData(value);\n  }\n\n\tObject.assign(config, option);\n\n\tif(option.navigate) {\n\t\tconfig.navigator.navigate = option.navigate;\n\t\tdelete option.navigate;\n\t}\n\n  return {\n    snapshot(value?: any){\n      if(arguments.length){\n        setData(value);\n      } else {\n        setData();\n      }\n    },\n  };\n}\n\nfunction polyfill() {\n\tsetTimeout(() => {\n    // @ts-ignore\n    const app = window.app;\n    const __vue_app__ = app &&app.__vue_app__;\n    const _context = __vue_app__ && __vue_app__._context;\n    const config = _context && _context.config;\n    const globalProperties = config && config.globalProperties;\n    const $router = globalProperties && globalProperties.$router;\n\n\t\tif($router) {\n\t\t\textendVueRouterApi($router);\n\t\t} else {\n\t\t\textendReactHistoryApi();\n\t\t}\n\t}, 10);\n}\n\naddRouter();\naddBeforeUnload();\npolyfill();\n\n\n\n\n\n\n\n\n"],"names":[],"mappings":"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"}